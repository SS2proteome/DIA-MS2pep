# DIA-MS2pep

### Introduction
DIA-MS2pep is well-compatible to Linux system users. For Windows system users, the setup of a Unix environment (Cygwin) is required (The installation process is automated and not complicated). DIA-MS2pep require Perl programming language (versions 5.26), including the Perl modules including *Math*, *MIME*, *Statistics*. 

### External tools:
1.       Msconvert (ProteoWizard, Version 3.0.9974)

2.       MSFragger (Version 2.4, or above)

3.       Percolator (Version 3.02.1)

### Data processing (Here we suppose “demo_DIA.raw” as an example file of DIA data)
## 1.       Convert Raw files to mzML files
MSconvert in ProteoWizard is recommended tool to convert the raw MS data to mzML files.

One can save the following operation parameters into configure file (*msconvert.config*):
“mzML=true
zlib=true
mz64=true
inten64=true
simAsSpectra=true
filter=”peakPicking vendor msLevel=1-2”
Command line:
msconvert -c msconvert.config demo_DIA.raw                                       
## 2.       Convert mzML files to mgf and ms1 files
DIA-MS2pep requires mgf and ms1 file for data processing. They can be generated by using either msconvert or in-house Perl script: RAW.mzML.parser.pl (/DIA-MS2pep/Scripts/DataConvert/).
<code> msconvert --mgf demo_DIA.mzML</code>
msconvert --ms1 demo_DIA.mzML 
OR
RAW.mzML.parser.pl mgf demo_DIA.mzML 
RAW.mzML.parser.pl ms1 demo_DIA.mzML 
## 3.       Read isolation window setting parameter of DIA data acquisition from mzMLs
 DIA_acquisition_window_generator.pl mgf demo_DIA.mzML
One file named “demo_DIA.mzML.DIA_acquisition_window.txt” will be generated in the current directory.
## 4.       Run DIA_pseudoMS2.pl to generate the pseudo-spectra (.mgfs) 
Usage: DIA_pseudoMS2.pl [Filename] [Directory] [ms2 mass tolerance ppm]
-- Filename: It doesn’t contain the file extension, and blank space in filename is not allowed in filename to avoid the misinterpretation of commands in Linux environment.
-- Directory: it is set for the creation of new directory, where the pseudo-spectrum will go.
-- ms2 mass tolerance ppm: it depends on the resolution setting when DIA data was acquired.
DIA_pseudoMS2.pl demo_DIA demo 30 
Output: After the running of DIA_pseudoMS2.pl is finished, one can find the pseudo-mgf file in the folder of “demo”. The name and number of pseudo-mgf file(s) is dependent on the isolation window size. If one fixed-set window size (S) is set for demo_DIA.raw, there will be only one pseudo-mgf file in folder of “demo”, names as “w_S_demo_DIA.mgf”. If several variable window sizes are set (S1, S2, …, Sn), multiple pseudo-mgf files will be generated, named as “w_S1_demo_DIA.mgf”, “w_S2_demo_DIA.mgf”,…, “w_Sn_demo_DIA.mgf”.
## 5.       Prepare the parameter file for MSFragger (“demo_MSFragger.params”)
The sample parameter file can be found in /DIA-MS2pep/DataSearch/MSFragger
Following parameters are used as recommended:
Calibrate_mass = 0
Output_report_topN = 5
Output_file_extension = pepXML
Minimum_peaks = 15
use_topN_peaks = 150
min_fragments_modelling = 2
min_matched_fragments = 4
minimum_ratio = 0
deisotope = 1
intensity_transform = 0
## 6.       Run MSFragger_runner.sh to perform larger precursor mass tolerance search with MSFragger.
Usage: MSFragger_runner.sh [Filename] [Directory of pseudo-mgfs]
MSFragger_runner.sh demo_MSFragger.params demo_DIA demo
## 7.       Run DIA_data_refinement.pl
Usage: DIA_data_refinement.pl [Filename] [Directory of pseudo-mgfs] [ms1 tolerance] [ms2 tolerance] [Phosphorylation 1/0]
For the sample of phosphopeptides, DIA_data_refinement will open the option for compute the site localization probability. 
Input file of DIA_data_refinement.pl is pepXML files generated by MSFragger, and its output is pin format file, containing peptide scores calculated by MSFragger, and auxiliary peptide scores calculated by this script.
DIA_data_refinement.pl demo_DIA demo 10 30 1
## 8.       Run Percolator_runner.sh to perform FDR estimation by Percolator and to generate the results of peptide and protein identification. 
Usage: Percolator_runner.sh [Filename] [FASTA file]
To simplify the process, all the above steps can be finished using DIA_MS2pep_runner.sh (/DIA-MS2pep/runner/ DIA_MS2pep_runner.sh), with its configuration file of DIA_MS2pep.config (/DIA-MS2pep/Config/DIA_MS2pep.config). 
DIA_MS2pep_runner.sh DIA_MS2pep.config
